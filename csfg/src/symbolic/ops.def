//extern fold_constants

remove_useless_ops {
    //fold_constants

    "-(-a)"         --> "a"
    //"0+a"           --> "a"
    //"1*a"           --> "a"
    //"-1*a"          --> "-a"
    //"a^1"           --> "a"
    //"a^0"           --> "1"
    //"a*a^-1"        --> "1"
    //"a^-1^-1"       --> "a"

    //"a*b/b"         --> "a"
    //"-a*b/b"        --> "-a"
    //"a*-b/b"        --> "-a"
    //"-(a*b)/b"      --> "-a"
    //"a*b/(b*c)"     --> "a/c"
    //"-a*b/(b*c)"    --> "-a/c"
    //"a*-b/(b*c)"    --> "-a/c"
    //"-(a*b)/(b*c)"  --> "-a/c"
}

//extern expand_constant_exponents

factor {
    "a + s^-c"      --> "s^-c * (a*s^c + 1)"
    //"a + b*s^-c"    --> "s^-c * (a*s^c + b)"

    //"s*s"           --> "s^2"
    //"s*s^c"         --> "s^(c+1)" [c=const]
    //"s^a * s^b"     --> "s^(a+b)"

    //"s+s"           --> "2*s"
    //"s+c*s"         --> "(c+1)*s" [c=const]
    //"s*a + s*b"     --> "s*(a+b)"
}

expand {
    //    expand_constant_exponents
    "s^(a+b)"       --> "s^a * s^b"
    "s*(a+b)"       --> "s*a + s*b"
}

simplify {
    expand
    remove_useless_ops
    factor
    remove_useless_ops
}
